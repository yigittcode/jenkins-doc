<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yomu API - Deployment DokÃ¼mantasyonu</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app">
        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <span class="logo-icon">ğŸ”§</span>
                    <span>Yomu API</span>
                </div>
                <p class="subtitle">Basic Deployment</p>
                <a href="index.html" class="back-link">â† Ana Sayfa</a>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">BaÅŸlangÄ±Ã§</div>
                    <a href="#hero" class="nav-item active">
                        <span class="icon">ğŸ </span>
                        <span>GiriÅŸ</span>
                    </a>
                    <a href="#pipeline" class="nav-item">
                        <span class="icon">âš™ï¸</span>
                        <span>Pipeline MantÄ±ÄŸÄ±</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Gereksinimler</div>
                    <a href="#prerequisites" class="nav-item">
                        <span class="icon">ğŸ“‹</span>
                        <span>Ã–n Gereksinimler</span>
                    </a>
                    <a href="#aws-config" class="nav-item">
                        <span class="icon">â˜ï¸</span>
                        <span>AWS KonfigÃ¼rasyonu</span>
                    </a>
                    <a href="#iam-policies" class="nav-item">
                        <span class="icon">ğŸ”</span>
                        <span>IAM PolitikalarÄ±</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Detaylar</div>
                    <a href="#pipeline-details" class="nav-item">
                        <span class="icon">ğŸ”§</span>
                        <span>Pipeline DetaylarÄ±</span>
                    </a>
                    <a href="#jenkinsfile-reference" class="nav-item">
                        <span class="icon">ğŸ“„</span>
                        <span>Jenkinsfile ReferansÄ±</span>
                    </a>
                    <a href="#jenkinsfile-generator" class="nav-item">
                        <span class="icon">âš¡</span>
                        <span>Jenkinsfile OluÅŸturucu</span>
                    </a>
                    <a href="#setup-guide" class="nav-item">
                        <span class="icon">ğŸ“š</span>
                        <span>Kurulum Rehberi</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Destek</div>
                    <a href="#troubleshooting" class="nav-item">
                        <span class="icon">ğŸ”</span>
                        <span>Sorun Giderme</span>
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Overlay for mobile -->
        <div class="overlay" id="overlay"></div>

        <!-- Main Content -->
        <main class="main">
            <!-- Header -->
            <header class="header">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <button class="menu-toggle" id="menuToggle">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 12h18M3 6h18M3 18h18"/>
                        </svg>
                    </button>
                    <h1 class="header-title">Deployment DokÃ¼mantasyonu</h1>
                </div>
                <div class="header-actions">
                    <span style="font-size: 0.85rem; color: var(--text-muted);">v1.0.0</span>
                </div>
            </header>

            <!-- Content -->
            <div class="content">
                <!-- Hero Section -->
                <section class="hero" id="hero">
                    <div class="hero-content">
                        <span class="hero-badge">
                            <span>ğŸš€</span>
                            CI/CD Pipeline & AWS Infrastructure
                        </span>
                        <h1 class="hero-title">Yomu API Deployment DokÃ¼mantasyonu</h1>
                        <p class="hero-subtitle">
                            Bu dokÃ¼man, Yomu API projesinin Jenkins CI/CD sÃ¼reÃ§lerini, AWS altyapÄ± gereksinimlerini,
                            gerekli izinleri ve deployment mantÄ±ÄŸÄ±nÄ± tek bir yerde toplar.
                        </p>
                    </div>
                </section>

                <!-- Pipeline Overview -->
                <section class="section" id="pipeline">
                    <h2 class="section-title">
                        <span class="number">1</span>
                        Pipeline Ã‡alÄ±ÅŸma MantÄ±ÄŸÄ±
                    </h2>
                    <div class="section-content">
                        <p>Bu pipeline, Jenkins Ã¼zerinde Ã§alÄ±ÅŸÄ±r ve AWS altyapÄ±sÄ±yla (EC2, SSM, CloudWatch) entegre bir ÅŸekilde deployment yapar. SÃ¼reÃ§ ÅŸu adÄ±mlardan oluÅŸur:</p>

                        <div class="pipeline-steps">
                            <div class="pipeline-step">
                                <span class="step-number">1</span>
                                <div class="step-content">
                                    <div class="step-title">Checkout</div>
                                    <div class="step-desc">Kodun en gÃ¼ncel hali Git deposundan Ã§ekilir.</div>
                                </div>
                            </div>
                            <div class="pipeline-step">
                                <span class="step-number">2</span>
                                <div class="step-content">
                                    <div class="step-title">Build & Push</div>
                                    <div class="step-desc">Docker imajÄ± oluÅŸturulur ve Docker Hub'a gÃ¶nderilir.</div>
                                </div>
                            </div>
                            <div class="pipeline-step">
                                <span class="step-number">3</span>
                                <div class="step-content">
                                    <div class="step-title">Config Fetching</div>
                                    <div class="step-desc">AWS SSM Parameter Store'dan ÅŸifreli Ã§evre deÄŸiÅŸkenleri (.env) ve sunucu IP bilgileri Ã§ekilir.</div>
                                </div>
                            </div>
                            <div class="pipeline-step">
                                <span class="step-number">4</span>
                                <div class="step-content">
                                    <div class="step-title">Logging Config</div>
                                    <div class="step-desc">Docker konteyner loglarÄ±nÄ± AWS CloudWatch'a aktarmak iÃ§in dinamik bir konfigÃ¼rasyon oluÅŸturulur.</div>
                                </div>
                            </div>
                            <div class="pipeline-step">
                                <span class="step-number">5</span>
                                <div class="step-content">
                                    <div class="step-title">File Transfer (SCP)</div>
                                    <div class="step-desc">.env, docker-compose.prod.yml, gunicorn_conf.py ve CloudWatch ayarlarÄ± hedef sunucuya kopyalanÄ±r.</div>
                                </div>
                            </div>
                            <div class="pipeline-step">
                                <span class="step-number">6</span>
                                <div class="step-content">
                                    <div class="step-title">Deployment (SSH)</div>
                                    <div class="step-desc">Hedef sunucuda servisler yeniden baÅŸlatÄ±lÄ±r ve CloudWatch ajanÄ± konfigÃ¼re edilir.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Prerequisites -->
                <section class="section" id="prerequisites">
                    <h2 class="section-title">
                        <span class="number">2</span>
                        Ã–n Gereksinimler
                    </h2>
                    <div class="section-content">
                        <p>Pipeline'Ä±n Ã§alÄ±ÅŸabilmesi iÃ§in Jenkins Agent ve Hedef Sunucu Ã¼zerinde aÅŸaÄŸÄ±daki araÃ§larÄ±n kurulu olmasÄ± gerekir.</p>

                        <div class="subsection">
                            <h3 class="subsection-title">A. Jenkins Sunucusu Gereksinimleri</h3>
                            <p>Jenkins'in <span class="code-inline">sh</span> komutlarÄ±nÄ± iÅŸleyebilmesi iÃ§in sunucuda ÅŸunlar yÃ¼klÃ¼ olmalÄ±dÄ±r:</p>

                            <div class="feature-grid">
                                <div class="feature-card">
                                    <div class="feature-card-icon">ğŸ³</div>
                                    <h4 class="feature-card-title">Docker</h4>
                                    <p class="feature-card-content">Ä°maj build iÅŸlemleri iÃ§in</p>
                                </div>
                                <div class="feature-card">
                                    <div class="feature-card-icon">ğŸ”¶</div>
                                    <h4 class="feature-card-title">AWS CLI v2</h4>
                                    <p class="feature-card-content">SSM servisinden veri Ã§ekmek iÃ§in</p>
                                </div>
                                <div class="feature-card">
                                    <div class="feature-card-icon">ğŸ“Ÿ</div>
                                    <h4 class="feature-card-title">jq</h4>
                                    <p class="feature-card-content">AWS'den dÃ¶nen JSON verisini parse etmek iÃ§in</p>
                                </div>
                                <div class="feature-card">
                                    <div class="feature-card-icon">ğŸ”‘</div>
                                    <h4 class="feature-card-title">OpenSSH Client</h4>
                                    <p class="feature-card-content">ssh ve scp komutlarÄ± iÃ§in</p>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <h3 class="subsection-title">B. Hedef Sunucu Docker Kurulumu</h3>
                            <p>Jenkins'in deployment yapacaÄŸÄ± hedef sunucuya SSH ile baÄŸlanÄ±p Docker'Ä± kurun. Bu iÅŸlem deployment yapÄ±lacak sunucuda <strong>bir kereye mahsus</strong> yapÄ±lmalÄ±dÄ±r.</p>

                            <div class="feature-grid">
                                <div class="feature-card">
                                    <h4 class="feature-card-title">ğŸ“Ÿ Amazon Linux 2 / 2023</h4>
                                    <div class="feature-card-content">
                                        <div class="code-block" data-lang="Bash">
<pre><code># Sunucuya SSH ile baÄŸlanÄ±n
ssh ec2-user@<SUNUCU_IP>

# Sistemi gÃ¼ncelleyin
sudo yum update -y

# Docker'Ä± kurun
sudo yum install -y docker

# Docker servisini baÅŸlatÄ±n ve otomatik baÅŸlatma ayarÄ±nÄ± yapÄ±n
sudo systemctl start docker
sudo systemctl enable docker

# KullanÄ±cÄ±yÄ± docker grubuna ekleyin (sudo olmadan docker komutu Ã§alÄ±ÅŸtÄ±rmak iÃ§in)
sudo usermod -aG docker ec2-user

# Grup deÄŸiÅŸikliÄŸini aktif etmek iÃ§in Ã§Ä±kÄ±ÅŸ yapÄ±p tekrar girin
# Veya aÅŸaÄŸÄ±daki komutu Ã§alÄ±ÅŸtÄ±rÄ±n:
newgrp docker

# Docker sÃ¼rÃ¼mÃ¼nÃ¼ kontrol edin
docker --version</code></pre>
                                        </div>
                                    </div>
                                </div>

                                <div class="feature-card">
                                    <h4 class="feature-card-title">ğŸ§ Ubuntu / Debian</h4>
                                    <div class="feature-card-content">
                                        <div class="code-block" data-lang="Bash">
<pre><code># Sunucuya SSH ile baÄŸlanÄ±n
ssh ubuntu@<SUNUCU_IP>

# Sistemi gÃ¼ncelleyin
sudo apt-get update -y

# Docker'Ä± kurun
sudo apt-get install -y docker.io docker-compose

# Docker servisini baÅŸlatÄ±n
sudo systemctl start docker
sudo systemctl enable docker

# KullanÄ±cÄ±yÄ± docker grubuna ekleyin
sudo usermod -aG docker ubuntu

# Grup deÄŸiÅŸikliÄŸini aktif etmek iÃ§in
newgrp docker

# Docker sÃ¼rÃ¼mÃ¼nÃ¼ kontrol edin
docker --version</code></pre>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="info-card success">
                                <div class="info-card-title">
                                    <span>âœ…</span>
                                    DoÄŸrulama
                                </div>
                                <p class="info-card-content">
                                    Docker'Ä±n doÄŸru kurulup kurulmadÄ±ÄŸÄ±nÄ± test etmek iÃ§in:
                                    <code>docker run hello-world</code> komutunu Ã§alÄ±ÅŸtÄ±rÄ±n.
                                    "Hello from Docker!" mesajÄ±nÄ± gÃ¶rÃ¼rseniz kurulum baÅŸarÄ±lÄ± demektir.
                                </p>
                            </div>

                            <div class="info-card warning">
                                <div class="info-card-title">
                                    <span>âš ï¸</span>
                                    Ã–nemli Not
                                </div>
                                <p class="info-card-content">
                                    Jenkins deployment sÄ±rasÄ±nda <code>docker pull</code> ve <code>docker-compose up</code>
                                    komutlarÄ±nÄ± Ã§alÄ±ÅŸtÄ±racaÄŸÄ± iÃ§in kullanÄ±cÄ±nÄ±n (ec2-user veya ubuntu) docker grubunda olmasÄ± zorunludur.
                                </p>
                            </div>
                        </div>

                        <div class="subsection">
                            <h3 class="subsection-title">C. Jenkins Credentials TanÄ±mlarÄ±</h3>
                            <p>Jenkins panelinde aÅŸaÄŸÄ±daki kimlik bilgileri oluÅŸturulmalÄ±dÄ±r:</p>

                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Credential ID</th>
                                            <th>TÃ¼r</th>
                                            <th>AÃ§Ä±klama</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><code>dockerhub-credentials</code></td>
                                            <td>Username with Password</td>
                                            <td>Docker Hub'a imaj pushlamak iÃ§in kullanÄ±cÄ± adÄ±/ÅŸifre</td>
                                        </tr>
                                        <tr>
                                            <td><code>deploy-server-ssh-key</code></td>
                                            <td>SSH Username with private key</td>
                                            <td>EC2 sunucusuna SSH baÄŸlantÄ±sÄ± iÃ§in .pem anahtarÄ±</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- AWS Configuration -->
                <section class="section" id="aws-config">
                    <h2 class="section-title">
                        <span class="number">3</span>
                        AWS AltyapÄ± KonfigÃ¼rasyonu
                    </h2>
                    <div class="section-content">
                        <div class="info-card">
                            <div class="info-card-title">
                                <span>â„¹ï¸</span>
                                SSM Parameter Store
                            </div>
                            <p class="info-card-content">
                                Proje, hard-coded config dosyalarÄ± yerine AWS Systems Manager (SSM) kullanÄ±r.
                                AWS Console Ã¼zerinden aÅŸaÄŸÄ±daki parametrelerin oluÅŸturulmuÅŸ olmasÄ± zorunludur.
                            </p>
                        </div>

                        <div class="subsection">
                            <h3 class="subsection-title">
                                <span class="badge">Secure</span>
                                /yomu/prod/ AltÄ±ndaki DeÄŸiÅŸkenler
                            </h3>
                            <p>Bu yolun altÄ±ndaki her ÅŸey otomatik olarak Ã§ekilip .env dosyasÄ±na yazÄ±lÄ±r:</p>

                            <div class="param-list">
                                <div class="param-item">
                                    <span class="param-path">/yomu/prod/DB_PASSWORD</span>
                                    <span class="param-type secure">SecureString</span>
                                </div>
                                <div class="param-item">
                                    <span class="param-path">/yomu/prod/SECRET_KEY</span>
                                    <span class="param-type secure">SecureString</span>
                                </div>
                                <div class="param-item">
                                    <span class="param-path">/yomu/prod/ANY_OTHER_VAR</span>
                                    <span class="param-type secure">SecureString</span>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <h3 class="subsection-title">
                                <span class="badge">Config</span>
                                /yomu/config/ AltÄ±ndaki DeÄŸiÅŸkenler
                            </h3>
                            <p>Deployment hedefi ve genel ayarlar burada tutulur:</p>

                            <div class="param-list">
                                <div class="param-item">
                                    <span class="param-path">CLOUDFRONT_DOMAIN</span>
                                    <span class="param-type string">String</span>
                                </div>
                                <div class="param-item">
                                    <span class="param-path">CLOUDFRONT_KEY_ID</span>
                                    <span class="param-type string">String</span>
                                </div>
                                <div class="param-item">
                                    <span class="param-path">YOMU_SERVER_IP</span>
                                    <span class="param-type string">String</span>
                                </div>
                                <div class="param-item">
                                    <span class="param-path">YOMU_SERVER_USER</span>
                                    <span class="param-type string">String</span>
                                </div>
                            </div>

                            <div class="info-card warning">
                                <div class="info-card-title">
                                    <span>âš ï¸</span>
                                    Ã–nemli Not
                                </div>
                                <p class="info-card-content">
                                    YOMU_SERVER_IP parametresi, deployment yapÄ±lacak sunucunun IP adresini iÃ§ermelidir.
                                    Bu deÄŸer, SCP ve SSH iÅŸlemlerinde hedef sunucu olarak kullanÄ±lÄ±r.
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- IAM Policies -->
                <section class="section" id="iam-policies">
                    <h2 class="section-title">
                        <span class="number">4</span>
                        Gerekli AWS IAM PolitikalarÄ±
                    </h2>
                    <div class="section-content">
                        <p>Sistemin Ã§alÄ±ÅŸmasÄ± iÃ§in iki farklÄ± IAM politikasÄ±na ihtiyaÃ§ vardÄ±r. Biri Jenkins sunucusu iÃ§in, diÄŸeri uygulamanÄ±n Ã§alÄ±ÅŸtÄ±ÄŸÄ± EC2 sunucusu iÃ§in.</p>

                        <div class="subsection">
                            <h3 class="subsection-title">A. Jenkins Sunucusu IAM PolitikasÄ±</h3>
                            <div class="info-card">
                                <div class="info-card-title">
                                    <span>ğŸ¯</span>
                                    Kime atanmalÄ±
                                </div>
                                <p class="info-card-content">
                                    Jenkins'in Ã§alÄ±ÅŸtÄ±ÄŸÄ± sunucunun IAM Role'Ã¼ne veya Jenkins AWS kullanÄ±cÄ±sÄ±na.
                                </p>
                            </div>
                            <p><strong>AmacÄ±:</strong> SSM Ã¼zerinden parametreleri okumak ve ÅŸifreli verileri Ã§Ã¶zmek.</p>

                            <div class="code-block" data-lang="JSON">
<pre><code>{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "AllowReadingSSMParams",
            "Effect": "Allow",
            "Action": [
                "ssm:GetParametersByPath",
                "ssm:GetParameter",
                "ssm:GetParameters"
            ],
            "Resource": [
                "arn:aws:ssm:eu-central-1:*:parameter/yomu/*"
            ]
        },
        {
            "Sid": "AllowDecryptingSecureStrings",
            "Effect": "Allow",
            "Action": [
                "kms:Decrypt"
            ],
            "Resource": "arn:aws:kms:eu-central-1:*:key/YOUR_KMS_KEY_ID"
        }
    ]
}</code></pre>
                            </div>

                            <div class="info-card success">
                                <div class="info-card-title">
                                    <span>ğŸ’¡</span>
                                    Not
                                </div>
                                <p class="info-card-content">
                                    EÄŸer AWS Managed Key kullanÄ±yorsanÄ±z KMS kÄ±smÄ±na gerek kalmayabilir,
                                    ancak SecureString kullanÄ±ldÄ±ÄŸÄ± iÃ§in genelde gereklidir.
                                </p>
                            </div>
                        </div>

                        <div class="subsection">
                            <h3 class="subsection-title">B. Hedef Sunucu (EC2) IAM PolitikasÄ±</h3>
                            <div class="info-card">
                                <div class="info-card-title">
                                    <span>ğŸ¯</span>
                                    Kime atanmalÄ±
                                </div>
                                <p class="info-card-content">
                                    UygulamanÄ±n Ã§alÄ±ÅŸtÄ±ÄŸÄ± (Deploy edilen) EC2 sunucusunun IAM Role'Ã¼ne.
                                </p>
                            </div>
                            <p><strong>AmacÄ±:</strong> Docker loglarÄ±nÄ± CloudWatch'a gÃ¶ndermek ve metrik toplamak.</p>

                            <div class="code-block" data-lang="JSON">
<pre><code>{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "CloudWatchLogsAccess",
            "Effect": "Allow",
            "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents",
                "logs:DescribeLogStreams"
            ],
            "Resource": [
                "arn:aws:logs:eu-central-1:*:log-group:/yomu/docker-logs:*"
            ]
        },
        {
            "Sid": "CloudWatchMetrics",
            "Effect": "Allow",
            "Action": [
                "cloudwatch:PutMetricData"
            ],
            "Resource": "*"
        }
    ]
}</code></pre>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Pipeline Details -->
                <section class="section" id="pipeline-details">
                    <h2 class="section-title">
                        <span class="number">5</span>
                        Pipeline AdÄ±m DetaylarÄ±
                    </h2>
                    <div class="section-content">

                        <div class="subsection">
                            <h3 class="subsection-title">.env DosyasÄ±nÄ±n Dinamik OluÅŸturulmasÄ±</h3>
                            <p>Pipeline iÃ§erisindeki aÅŸaÄŸÄ±daki blok, JSON Ã§Ä±ktÄ±sÄ±nÄ± .env formatÄ±na dÃ¶nÃ¼ÅŸtÃ¼ren kritik bir iÅŸlemdir:</p>

                            <div class="code-block" data-lang="Bash">
<pre><code>aws ssm get-parameters-by-path ... --output json | \
jq -r '.[] | "\\(.Name)=\\"\\(.Value)\\""' | \
sed 's|/yomu/prod/||' > .env</code></pre>
                            </div>

                            <p>Bu script ÅŸunlarÄ± yapar:</p>
                            <ul>
                                <li>SSM'den veriyi JSON olarak Ã§eker</li>
                                <li>jq ile JSON'u <code>ANAHTAR="DEÄER"</code> formatÄ±na Ã§evirir</li>
                                <li>sed ile anahtar isimlerinin baÅŸÄ±ndaki yolu (<code>/yomu/prod/</code>) temizler</li>
                            </ul>
                        </div>

                        <div class="subsection">
                            <h3 class="subsection-title">CloudWatch Log YapÄ±landÄ±rmasÄ±</h3>
                            <p>Sistem, Docker konteynerlerinin loglarÄ±nÄ± <code>/var/lib/docker/containers</code> dizininden okuyarak CloudWatch Ã¼zerinde <code>/yomu/docker-logs</code> log grubuna gÃ¶nderir.</p>

                            <div class="info-card">
                                <div class="info-card-title">
                                    <span>ğŸ“</span>
                                    KonfigÃ¼rasyon DosyasÄ±
                                </div>
                                <p class="info-card-content">
                                    Bu ayar <code>cloudwatch-config.json</code> dosyasÄ± ile deploy sÄ±rasÄ±nda sunucuya enjekte edilir.
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Jenkinsfile Reference -->
                <section class="section" id="jenkinsfile-reference">
                    <h2 class="section-title">
                        <span class="number">6</span>
                        Jenkinsfile ReferansÄ±
                    </h2>
                    <div class="section-content">
                        <p>AÅŸaÄŸÄ±da, projede kullanÄ±lan tam Jenkinsfile bulunmaktadÄ±r. Bu dosyayÄ± projenizin kÃ¶k dizinine <code>Jenkinsfile</code> adÄ±yla kaydedebilirsiniz.</p>

                        <div class="info-card">
                            <div class="info-card-title">
                                <span>ğŸ“</span>
                                Dosya Konumu
                            </div>
                            <p class="info-card-content">
                                Jenkinsfile, projenizin kÃ¶k dizininde (<code>repo/Jenkinsfile</code>) yer almalÄ±dÄ±r.
                                Jenkins bu dosyayÄ± otomatik olarak algÄ±lar ve pipeline'Ä± Ã§alÄ±ÅŸtÄ±rÄ±r.
                            </p>
                        </div>

                        <div class="code-block" data-lang="Groovy/Jenkinsfile">
<pre><code>pipeline {
    agent any

    environment {
        DOCKER_HUB_IMAGE = "proksiyazilimdocker/yomu-api:latest"
        DOCKER_HUB_CREDS_ID = "dockerhub-credentials"
        SSH_CREDENTIALS_ID = "deploy-server-ssh-key"
        AWS_REGION = "eu-central-1"
        SSM_SECRET_PATH = "/yomu/prod/"
        SSM_CONFIG_PATH = "/yomu/config/"
        YOMU_APP_DIR = "/home/ec2-user/yomu-app"
    }

    stages {
        stage('1. Checkout Code') {
            steps {
                checkout scm
            }
        }

        stage('2. Build & Push Docker Image') {
            steps {
                withCredentials([usernamePassword(credentialsId: DOCKER_HUB_CREDS_ID, usernameVariable: 'DOCKER_USER', passwordVariable: 'DOCKER_PASS')]) {
                    sh "echo ${DOCKER_PASS} | docker login -u ${DOCKER_USER} --password-stdin"
                    sh "docker build -t ${DOCKER_HUB_IMAGE} ."
                    sh "docker push ${DOCKER_HUB_IMAGE}"
                }
            }
        }

        stage('3. Deploy to Server') {
            steps {
                script {
                    echo "Gizli bilgileri (.env) AWS SSM'den Ã§ekiyorum..."
                    sh """
                        aws ssm get-parameters-by-path \
                            --path "${SSM_SECRET_PATH}" \
                            --with-decryption \
                            --region "${AWS_REGION}" \
                            --query "Parameters[*].{Name:Name,Value:Value}" \
                            --output json | \
                        jq -r '.[] | "\\(.Name)=\\"\\(.Value)\\""' | \
                        sed 's|${SSM_SECRET_PATH}||' > .env

                        CLOUDFRONT_DOMAIN=\$(aws ssm get-parameter --name "${SSM_CONFIG_PATH}CLOUDFRONT_DOMAIN" --region "${AWS_REGION}" --query 'Parameter.Value' --output text)
                        CLOUDFRONT_KEY_ID=\$(aws ssm get-parameter --name "${SSM_CONFIG_PATH}CLOUDFRONT_KEY_ID" --region "${AWS_REGION}" --query 'Parameter.Value' --output text)

                        echo "LOCAL=false" >> .env
                        echo "CLOUDFRONT_DOMAIN=\${CLOUDFRONT_DOMAIN}" >> .env
                        echo "CLOUDFRONT_KEY_ID=\${CLOUDFRONT_KEY_ID}" >> .env
                    """

                    echo "CloudWatch Ajan ayar dosyasÄ± (cloudwatch-config.json) oluÅŸturuluyor..."
                    sh """
cat << EOF > cloudwatch-config.json
{
  "agent": {
    "run_as_user": "root"
  },
  "logs": {
    "logs_collected": {
      "files": {
        "collect_list": [
          {
            "file_path": "/var/lib/docker/containers/*/*-json.log",
            "log_group_name": "/yomu/docker-logs",
            "log_stream_name": "{instance_id}-build-${env.BUILD_NUMBER}-YomuAI",
            "timestamp_format": "%Y-%m-%dT%H:%M:%S.%fZ",
            "multi_line_start_pattern": "%Y-%m-%dT%H:%M:%S"
          }
        ]
      }
    },
    "force_flush_interval": 5
  }
}
EOF
                    """

                    echo "Sunucu IP ve KullanÄ±cÄ± adÄ±nÄ± AWS SSM'den Ã§ekiyorum..."
                    def serverIp = sh(
                        script: "aws ssm get-parameter --name '${SSM_CONFIG_PATH}YOMU_SERVER_IP' --region '${AWS_REGION}' --query 'Parameter.Value' --output text",
                        returnStdout: true
                    ).trim()

                    def serverUser = sh(
                        script: "aws ssm get-parameter --name '${SSM_CONFIG_PATH}YOMU_SERVER_USER' --region '${AWS_REGION}' --query 'Parameter.Value' --output text",
                        returnStdout: true
                    ).trim()

                    echo "Dosyalar ${serverUser}@${serverIp} sunucusuna kopyalanÄ±yor..."

                    withCredentials([sshUserPrivateKey(credentialsId: "${SSH_CREDENTIALS_ID}", keyFileVariable: 'SSH_KEY')]) {
                        sh "ssh -o StrictHostKeyChecking=no -i ${SSH_KEY} ${serverUser}@${serverIp} 'mkdir -p ${YOMU_APP_DIR}'"
                        sh "scp -o StrictHostKeyChecking=no -i ${SSH_KEY} .env ${serverUser}@${serverIp}:${YOMU_APP_DIR}/.env"
                        sh "scp -o StrictHostKeyChecking=no -i ${SSH_KEY} docker-compose.prod.yml ${serverUser}@${serverIp}:${YOMU_APP_DIR}/docker-compose.prod.yml"
                        sh "scp -o StrictHostKeyChecking=no -i ${SSH_KEY} gunicorn_conf.py ${serverUser}@${serverIp}:${YOMU_APP_DIR}/gunicorn_conf.py"
                        sh "scp -o StrictHostKeyChecking=no -i ${SSH_KEY} cloudwatch-config.json ${serverUser}@${serverIp}:/tmp/cloudwatch-config.json"

                        sh """
                            ssh -o StrictHostKeyChecking=no -i ${SSH_KEY} ${serverUser}@${serverIp} "
                                echo 'CloudWatch Agent kuruluyor/gÃ¼ncelleniyor...'
                                sudo yum install -y amazon-cloudwatch-agent

                                echo 'CloudWatch Agent (Docker loglarÄ± iÃ§in) dosyadan baÅŸlatÄ±lÄ±yor...'
                                sudo /opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent-ctl -a fetch-config -m ec2 -c file:/tmp/cloudwatch-config.json -s

                                cd ${YOMU_APP_DIR} && \
                                echo 'Yeni imajÄ± Docker Hub''dan Ã§ekiyorum (pull)...' && \
                                docker-compose -f docker-compose.prod.yml pull && \
                                echo 'Servisleri yeniden baÅŸlatÄ±yorum (up -d)...' && \
                                docker-compose -f docker-compose.prod.yml up -d --force-recreate
                            "
                        """
                    }
                }
            }
        }
    }

    post {
        always {
            echo "GeÃ§ici dosyalar Jenkins'ten siliniyor..."
            sh 'rm -f .env cloudwatch-config.json'
        }
    }
}</code></pre>
                        </div>

                        <div class="info-card success">
                            <div class="info-card-title">
                                <span>ğŸ’¡</span>
                                KullanÄ±m
                            </div>
                            <p class="info-card-content">
                                Bu Jenkinsfile'Ä± projenize ekledikten sonra Jenkins'te yeni bir "Pipeline" job'u oluÅŸturun,
                                Git reposunu iÅŸaret edin ve "Build Now" ile Ã§alÄ±ÅŸtÄ±rÄ±n.
                            </p>
                        </div>
                    </div>
                </section>

                <!-- Jenkinsfile Generator -->
                <section class="section" id="jenkinsfile-generator">
                    <h2 class="section-title">
                        <span class="number">7</span>
                        Jenkinsfile OluÅŸturucu
                    </h2>
                    <div class="section-content">
                        <p>AÅŸaÄŸÄ±daki formu doldurarak projenize Ã¶zel Jenkinsfile'Ä± oluÅŸturabilirsiniz. TÃ¼m alanlarÄ± doldurduktan sonra "OluÅŸtur" butonuna tÄ±klayÄ±n.</p>

                        <div class="generator-container">
                            <form id="jenkinsfileForm" class="generator-form">
                                <div class="form-section">
                                    <h4 class="form-section-title">ğŸ³ Docker AyarlarÄ±</h4>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="dockerImage">Docker Ä°maj AdÄ±</label>
                                            <input type="text" id="dockerImage" name="dockerImage" placeholder="Ã¶rn: username/repo:latest" value="proksiyazilimdocker/yomu-api:latest" required>
                                            <small>Hub.docker.comdaki imaj adÄ±nÄ±z</small>
                                        </div>
                                        <div class="form-group">
                                            <label for="dockerCredsId">Docker Hub Credential ID</label>
                                            <input type="text" id="dockerCredsId" name="dockerCredsId" placeholder="Jenkins'teki credential ID" value="dockerhub-credentials" required>
                                            <small>Jenkins Credentials'daki ID</small>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <h4 class="form-section-title">ğŸ” SSH AyarlarÄ±</h4>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="sshCredsId">SSH Credential ID</label>
                                            <input type="text" id="sshCredsId" name="sshCredsId" placeholder="Jenkins'teki credential ID" value="deploy-server-ssh-key" required>
                                            <small>Jenkins Credentials'daki SSH key ID</small>
                                        </div>
                                        <div class="form-group">
                                            <label for="appDir">Uygulama Dizini (Sunucuda)</label>
                                            <input type="text" id="appDir" name="appDir" placeholder="Ã¶rn: /home/ec2-user/yomu-app" value="/home/ec2-user/yomu-app" required>
                                            <small>Deploy yapÄ±lacak hedef dizin</small>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <h4 class="form-section-title">â˜ï¸ AWS AyarlarÄ±</h4>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="awsRegion">AWS BÃ¶lgesi</label>
                                            <select id="awsRegion" name="awsRegion">
                                                <option value="eu-central-1" selected>eu-central-1 (Frankfurt)</option>
                                                <option value="eu-west-1">eu-west-1 (Ireland)</option>
                                                <option value="eu-west-2">eu-west-2 (London)</option>
                                                <option value="us-east-1">us-east-1 (N. Virginia)</option>
                                                <option value="us-west-2">us-west-2 (Oregon)</option>
                                                <option value="ap-northeast-1">ap-northeast-1 (Tokyo)</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="ssmSecretPath">SSM Secret Path</label>
                                            <input type="text" id="ssmSecretPath" name="ssmSecretPath" placeholder="/yomu/prod" value="/yomu/prod" required>
                                            <small>SecureString parametrelerin yolu (sonuna / eklenmez)</small>
                                        </div>
                                        <div class="form-group">
                                            <label for="ssmConfigPath">SSM Config Path</label>
                                            <input type="text" id="ssmConfigPath" name="ssmConfigPath" placeholder="/yomu/config" value="/yomu/config" required>
                                            <small>Genel konfigÃ¼rasyon yolu (sonuna / eklenmez)</small>
                                        </div>
                                        <div class="form-group">
                                            <label for="logGroupName">CloudWatch Log Group</label>
                                            <input type="text" id="logGroupName" name="logGroupName" placeholder="/yomu/docker-logs" value="/yomu/docker-logs" required>
                                            <small>LoglarÄ±n gÃ¶nderileceÄŸi grup</small>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                            <polyline points="7 10 12 15 17 10"/>
                                            <line x1="12" y1="15" x2="12" y2="3"/>
                                        </svg>
                                        Jenkinsfile OluÅŸtur
                                    </button>
                                    <button type="button" class="btn btn-secondary" id="resetForm">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                                            <path d="M3 3v5h5"/>
                                        </svg>
                                        SÄ±fÄ±rla
                                    </button>
                                </div>
                            </form>

                            <!-- Generated Output -->
                            <div class="output-container" id="outputContainer" style="display: none;">
                                <div class="output-header">
                                    <h3>OluÅŸturulan Jenkinsfile</h3>
                                    <div class="output-actions">
                                        <button class="btn-sm btn-copy" id="copyOutput">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                                            </svg>
                                            Kopyala
                                        </button>
                                        <button class="btn-sm btn-download" id="downloadOutput">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                                <polyline points="7 10 12 15 17 10"/>
                                                <line x1="12" y1="15" x2="12" y2="3"/>
                                            </svg>
                                            Ä°ndir
                                        </button>
                                    </div>
                                </div>
                                <div class="code-block" data-lang="Groovy">
                                    <pre id="generatedCode"></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Setup Guide -->
                <section class="section" id="setup-guide">
                    <h2 class="section-title">
                        <span class="number">8</span>
                        Kurulum ve Entegrasyon Rehberi
                    </h2>
                    <div class="section-content">
                        <p>Bu bÃ¶lÃ¼m, sÄ±fÄ±rdan kurulum yapacak geliÅŸtirici iÃ§in kimlik doÄŸrulama ve otomasyon adÄ±mlarÄ±nÄ± detaylandÄ±rÄ±r.</p>

                        <div class="subsection">
                            <h3 class="subsection-title">D. SSH EriÅŸiminin AyarlanmasÄ±</h3>
                            <p>Jenkins'in hedef sunucuya dosya atabilmesi ve komut Ã§alÄ±ÅŸtÄ±rabilmesi iÃ§in SSH Key Ã§ifti (Private/Public) gereklidir.</p>

                            <div class="feature-card" style="margin: 1rem 0;">
                                <h4 class="feature-card-title">ğŸ”‘ Anahtar OluÅŸturma</h4>
                                <p class="feature-card-content">Local bilgisayar veya Jenkins sunucusunda:</p>
                            </div>

                            <div class="code-block" data-lang="Bash">
<pre><code>ssh-keygen -t rsa -b 4096 -f yomu_deploy_key</code></pre>
                            </div>

                            <p>Bu komut size <code>yomu_deploy_key</code> (Private) ve <code>yomu_deploy_key.pub</code> (Public) dosyalarÄ±nÄ± verir.</p>

                            <div class="feature-card" style="margin: 1rem 0;">
                                <h4 class="feature-card-title">ğŸš€ Hedef Sunucuya Public Key Ekleme</h4>
                                <div class="feature-card-content">
                                    <ol style="margin-left: 1.5rem; margin-top: 0.5rem;">
                                        <li><code>yomu_deploy_key.pub</code> dosyasÄ±nÄ±n iÃ§eriÄŸini kopyalayÄ±n</li>
                                        <li>Hedef sunucuya SSH ile baÄŸlanÄ±n</li>
                                        <li><code>~/.ssh/authorized_keys</code> dosyasÄ±nÄ± aÃ§Ä±n ve en alta bu iÃ§eriÄŸi yapÄ±ÅŸtÄ±rÄ±n</li>
                                        <li>Dosya izinlerini doÄŸrulayÄ±n: <code>chmod 600 ~/.ssh/authorized_keys</code></li>
                                    </ol>
                                </div>
                            </div>

                            <div class="feature-card" style="margin: 1rem 0;">
                                <h4 class="feature-card-title">ğŸ”§ Jenkins'e Private Key Ekleme</h4>
                                <div class="feature-card-content">
                                    <ol style="margin-left: 1.5rem; margin-top: 0.5rem;">
                                        <li>Jenkins Panel â†’ Manage Jenkins â†’ Credentials â†’ System â†’ Global credentials</li>
                                        <li><strong>Kind:</strong> SSH Username with private key</li>
                                        <li><strong>ID:</strong> <code>deploy-server-ssh-key</code></li>
                                        <li><strong>Username:</strong> <code>ec2-user</code> (veya sunucu kullanÄ±cÄ±sÄ±)</li>
                                        <li><strong>Private Key:</strong> "Enter directly" seÃ§in ve <code>yomu_deploy_key</code> iÃ§eriÄŸini yapÄ±ÅŸtÄ±rÄ±n</li>
                                    </ol>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <h3 class="subsection-title">E. Docker Hub Kimlik Bilgileri</h3>
                            <p>Jenkins'in imajlarÄ± Docker Hub'a yÃ¼kleyebilmesi (push) iÃ§in gereklidir.</p>

                            <div class="feature-card" style="margin: 1rem 0;">
                                <h4 class="feature-card-title">ğŸ³ Docker Hub Access Token Alma</h4>
                                <div class="feature-card-content">
                                    <ol style="margin-left: 1.5rem; margin-top: 0.5rem;">
                                        <li>Docker Hub'a giriÅŸ yapÄ±n â†’ Account Settings â†’ Security â†’ New Access Token</li>
                                        <li>Token'a bir isim verin ve "Read & Write" yetkisi olduÄŸundan emin olun</li>
                                        <li>Token'Ä± kopyalayÄ±n</li>
                                    </ol>
                                </div>
                            </div>

                            <div class="feature-card" style="margin: 1rem 0;">
                                <h4 class="feature-card-title">ğŸ“ Jenkins'e Ekleme</h4>
                                <div class="feature-card-content">
                                    <ol style="margin-left: 1.5rem; margin-top: 0.5rem;">
                                        <li>Jenkins Panel â†’ Credentials â†’ Add Credentials</li>
                                        <li><strong>Kind:</strong> Username with password</li>
                                        <li><strong>Username:</strong> Docker Hub kullanÄ±cÄ± adÄ±nÄ±z</li>
                                        <li><strong>Password:</strong> Access Token</li>
                                        <li><strong>ID:</strong> <code>dockerhub-credentials</code></li>
                                    </ol>
                                </div>
                            </div>

                            <div class="info-card warning">
                                <div class="info-card-title">
                                    <span>âš ï¸</span>
                                    GÃ¼venlik Ã–nerisi
                                </div>
                                <p class="info-card-content">
                                    Kendi hesabÄ±nÄ±zÄ±n ÅŸifresini kullanmak yerine Access Token kullanmanÄ±z Ã¶nerilir.
                                </p>
                            </div>
                        </div>

                        <div class="subsection">
                            <h3 class="subsection-title">F. GitHub Webhook (Otomatik Tetikleme)</h3>
                            <p>Koda push yapÄ±ldÄ±ÄŸÄ±nda Jenkins'in otomatik Ã§alÄ±ÅŸmasÄ± iÃ§in:</p>

                            <div class="feature-card" style="margin: 1rem 0;">
                                <h4 class="feature-card-title">ğŸ”” Jenkins Job AyarÄ±</h4>
                                <div class="feature-card-content">
                                    <ol style="margin-left: 1.5rem; margin-top: 0.5rem;">
                                        <li>Projenin Jenkins Job ayarlarÄ±na gidin</li>
                                        <li>Build Triggers altÄ±nda "GitHub hook trigger for GITScm polling" seÃ§eneÄŸini iÅŸaretleyin</li>
                                    </ol>
                                </div>
                            </div>

                            <div class="feature-card" style="margin: 1rem 0;">
                                <h4 class="feature-card-title">ğŸ”— GitHub Repo AyarÄ±</h4>
                                <div class="feature-card-content">
                                    <ol style="margin-left: 1.5rem; margin-top: 0.5rem;">
                                        <li>GitHub reposunda Settings â†’ Webhooks â†’ Add webhook yolunu izleyin</li>
                                        <li><strong>Payload URL:</strong> <code>http://JENKINS_URL:8080/github-webhook/</code></li>
                                        <li><strong>Content type:</strong> application/json</li>
                                        <li><strong>Events:</strong> "Just the push event"</li>
                                        <li>Webhook'u kaydedin</li>
                                    </ol>
                                </div>
                            </div>

                            <div class="info-card success">
                                <div class="info-card-title">
                                    <span>âœ…</span>
                                    BaÅŸarÄ±lÄ± Webhook
                                </div>
                                <p class="info-card-content">
                                    YeÅŸil tik iÅŸareti, Jenkins'e baÅŸarÄ±yla ulaÅŸÄ±ldÄ±ÄŸÄ±nÄ± gÃ¶sterir.
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Troubleshooting -->
                <section class="section" id="troubleshooting">
                    <h2 class="section-title">
                        <span class="number">9</span>
                        Sorun Giderme
                    </h2>
                    <div class="section-content">

                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Hata MesajÄ±</th>
                                        <th>OlasÄ± Neden</th>
                                        <th>Ã‡Ã¶zÃ¼m</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><code>jq: command not found</code></td>
                                        <td>Jenkins sunucusunda jq eksik</td>
                                        <td><code>sudo yum install jq</code> veya <code>apt-get install jq</code></td>
                                    </tr>
                                    <tr>
                                        <td><code>AccessDeniedException (SSM)</code></td>
                                        <td>Jenkins IAM yetkisi eksik</td>
                                        <td>"Jenkins Sunucusu IAM PolitikasÄ±" bÃ¶lÃ¼mÃ¼ndeki izni kontrol edin</td>
                                    </tr>
                                    <tr>
                                        <td><code>docker login fails</code></td>
                                        <td>Credential hatasÄ±</td>
                                        <td>Jenkins'teki dockerhub-credentials ÅŸifresini gÃ¼ncelleyin</td>
                                    </tr>
                                    <tr>
                                        <td><code>CloudWatch loglarÄ± gelmiyor</code></td>
                                        <td>EC2 IAM yetkisi eksik</td>
                                        <td>Hedef sunucunun IAM rolÃ¼ne logs:CreateLogGroup ve logs:PutLogEvents yetkisi verin</td>
                                    </tr>
                                    <tr>
                                        <td><code>Host key verification failed</code></td>
                                        <td>SSH ilk baÄŸlantÄ± sorunu</td>
                                        <td>Pipeline StrictHostKeyChecking=no parametresini kullanÄ±yor</td>
                                    </tr>
                                    <tr>
                                        <td><code>Permission denied (publickey)</code></td>
                                        <td>SSH anahtarÄ± yanlÄ±ÅŸ</td>
                                        <td>Public key'in hedef sunucuda authorized_keys iÃ§inde olduÄŸundan emin olun</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Footer -->
                <footer class="footer">
                    <p>Yomu API Deployment DokÃ¼mantasyonu &copy; 2026</p>
                    <p style="margin-top: 0.5rem; color: var(--text-light);">
                        Jenkins CI/CD Pipeline & AWS Infrastructure Documentation
                    </p>
                </footer>
            </div>
        </main>
    </div>

    <!-- Scroll to Top Button -->
    <button class="scroll-top" id="scrollTop">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 19V5M5 12l7-7 7 7"/>
        </svg>
    </button>

    <script src="js/main.js"></script>
</body>
</html>
